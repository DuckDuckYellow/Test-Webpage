{% extends "base.html" %}

{% block title %}Recruitment Capacity Tracker - Newton's Repository{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero hero-sm">
    <div class="container">
        <h1 class="fw-bold mb-2">Recruitment Capacity Tracker</h1>
        <p class="mb-0 opacity-75">Calculate team capacity across different recruitment workload types</p>
    </div>
</section>

<div class="container py-5">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('home') }}">Home</a></li>
            <li class="breadcrumb-item"><a href="{{ url_for('projects') }}">Projects</a></li>
            <li class="breadcrumb-item active" aria-current="page">Capacity Tracker</li>
        </ol>
    </nav>

    <!-- Tool Description -->
    <div class="row mb-5">
        <div class="col-lg-10">
            <div class="card border-0 shadow-sm">
                <div class="card-body p-4">
                    <h2 class="h5 mb-3">About This Tool</h2>
                    <p class="mb-2">
                        This tool helps calculate recruitment team capacity based on the complexity of vacancies.
                        Each recruiter has different capacity limits depending on vacancy difficulty:
                    </p>
                    <ul class="mb-2">
                        <li><strong>Easy vacancies:</strong> Maximum 30 at full capacity</li>
                        <li><strong>Medium vacancies:</strong> Maximum 20 at full capacity</li>
                        <li><strong>Hard vacancies:</strong> Maximum 12 at full capacity</li>
                    </ul>
                    <p class="mb-0 text-muted small">
                        Mixed workloads combine cumulatively (e.g., 15 easy + 10 medium + 6 hard = 50% + 50% + 50% = 150% capacity - overloaded).
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Error Messages -->
    {% if errors %}
    <div class="alert alert-danger" role="alert">
        <strong>Please correct the following errors:</strong>
        <ul class="mb-0 mt-2">
            {% for error in errors %}
            <li>{{ error }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <!-- Input Form -->
    <div class="row mb-5">
        <div class="col-lg-10">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-bottom">
                    <h3 class="h5 mb-0 py-2">Add Recruiters</h3>
                </div>
                <div class="card-body p-4">
                    <form method="POST" id="capacityForm">
                        <div id="recruiterInputs">
                            <!-- Initial recruiter input row -->
                            <div class="recruiter-row mb-4 pb-4 border-bottom" data-index="0">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="form-label fw-semibold">Recruiter Name *</label>
                                        <input type="text" class="form-control" name="name_0" required
                                               placeholder="e.g., John Smith">
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label fw-semibold">Easy</label>
                                        <input type="number" class="form-control" name="easy_0"
                                               min="0" value="0" placeholder="0">
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label fw-semibold">Medium</label>
                                        <input type="number" class="form-control" name="medium_0"
                                               min="0" value="0" placeholder="0">
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label fw-semibold">Hard</label>
                                        <input type="number" class="form-control" name="hard_0"
                                               min="0" value="0" placeholder="0">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Add Recruiter Button -->
                        <div class="mb-4">
                            <button type="button" class="btn btn-outline-primary" id="addRecruiterBtn">
                                + Add Another Recruiter
                            </button>
                        </div>

                        <!-- Submit Button -->
                        <div class="d-grid gap-2 d-md-flex">
                            <button type="submit" class="btn btn-primary btn-lg px-5">
                                Calculate Capacity
                            </button>
                            <button type="button" class="btn btn-outline-secondary btn-lg" id="resetBtn">
                                Reset Form
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Results Section -->
    {% if recruiters %}
    <div class="row mb-5">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-bottom">
                    <h3 class="h5 mb-0 py-2">Capacity Results</h3>
                </div>
                <div class="card-body p-0">
                    <!-- Mobile-friendly table -->
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th scope="col">Recruiter</th>
                                    <th scope="col" class="text-center">Easy</th>
                                    <th scope="col" class="text-center">Medium</th>
                                    <th scope="col" class="text-center">Hard</th>
                                    <th scope="col" class="text-center">Capacity</th>
                                    <th scope="col" class="text-center">Status</th>
                                    <th scope="col">Remaining Capacity</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for recruiter in recruiters %}
                                <tr>
                                    <td class="fw-semibold">{{ recruiter.name }}</td>
                                    <td class="text-center">{{ recruiter.easy_vacancies }}</td>
                                    <td class="text-center">{{ recruiter.medium_vacancies }}</td>
                                    <td class="text-center">{{ recruiter.hard_vacancies }}</td>
                                    <td class="text-center fw-bold">{{ recruiter.capacity_percentage }}%</td>
                                    <td class="text-center">
                                        <span class="badge capacity-badge capacity-{{ recruiter.status }}">
                                            {{ recruiter.status_text }}
                                        </span>
                                    </td>
                                    <td class="small">{{ recruiter.remaining_message }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Team Summary -->
    {% if team_summary %}
    <div class="row mb-5">
        <div class="col-lg-10">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-bottom">
                    <h3 class="h5 mb-0 py-2">Team Summary</h3>
                </div>
                <div class="card-body p-4">
                    <div class="row g-4 text-center">
                        <div class="col-md-3">
                            <div class="p-3 bg-light rounded">
                                <div class="h2 mb-1 fw-bold text-primary">{{ team_summary.total_recruiters }}</div>
                                <div class="small text-muted">Team Members</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="p-3 bg-light rounded">
                                <div class="h2 mb-1 fw-bold text-primary">{{ team_summary.average_capacity }}%</div>
                                <div class="small text-muted">Average Capacity</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="p-3 rounded team-health-{{ team_summary.team_health }}">
                                <div class="h5 mb-1 fw-bold">{{ team_summary.team_health_text }}</div>
                                <div class="small">
                                    Available: {{ team_summary.status_counts.available }} |
                                    Near Capacity: {{ team_summary.status_counts['near-capacity'] }} |
                                    At Capacity: {{ team_summary.status_counts['at-capacity'] }} |
                                    Overloaded: {{ team_summary.status_counts.overloaded }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    {% endif %}

    <!-- Back to Projects -->
    <div class="mt-5 pt-3 border-top">
        <a href="{{ url_for('projects') }}" class="btn btn-outline-secondary">
            &larr; Back to Projects
        </a>
    </div>
</div>

<!-- Custom Styles -->
<style>
    /* Capacity Status Badges */
    .capacity-badge {
        padding: 0.5rem 0.75rem;
        font-size: 0.85rem;
        font-weight: 600;
        border-radius: 6px;
        display: inline-block;
        min-width: 100px;
    }

    .capacity-available {
        background-color: #28a745;
        color: white;
    }

    .capacity-near-capacity {
        background-color: #ffc107;
        color: #333;
    }

    .capacity-at-capacity {
        background-color: #dc3545;
        color: white;
    }

    .capacity-overloaded {
        background-color: #8b0000;
        color: white;
    }

    /* Team Health Indicators */
    .team-health-healthy {
        background-color: #d4edda;
        border: 2px solid #28a745;
    }

    .team-health-underutilized {
        background-color: #d1ecf1;
        border: 2px solid #17a2b8;
    }

    .team-health-warning {
        background-color: #fff3cd;
        border: 2px solid #ffc107;
    }

    .team-health-critical {
        background-color: #f8d7da;
        border: 2px solid #dc3545;
    }

    /* Form styling */
    .recruiter-row:last-child {
        border-bottom: none !important;
    }

    .form-label {
        margin-bottom: 0.5rem;
        color: #495057;
    }

    /* Responsive table */
    @media (max-width: 768px) {
        .table-responsive {
            font-size: 0.9rem;
        }

        .capacity-badge {
            font-size: 0.75rem;
            min-width: 80px;
            padding: 0.4rem 0.5rem;
        }
    }
</style>

<!-- JavaScript for Dynamic Form -->
<script>
    let recruiterCount = 1;

    // Add new recruiter row
    document.getElementById('addRecruiterBtn').addEventListener('click', function() {
        const container = document.getElementById('recruiterInputs');
        const newRow = document.createElement('div');
        newRow.className = 'recruiter-row mb-4 pb-4 border-bottom';
        newRow.setAttribute('data-index', recruiterCount);

        newRow.innerHTML = `
            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label fw-semibold">Recruiter Name *</label>
                    <input type="text" class="form-control" name="name_${recruiterCount}" required
                           placeholder="e.g., Jane Doe">
                </div>
                <div class="col-md-2">
                    <label class="form-label fw-semibold">Easy</label>
                    <input type="number" class="form-control" name="easy_${recruiterCount}"
                           min="0" value="0" placeholder="0">
                </div>
                <div class="col-md-2">
                    <label class="form-label fw-semibold">Medium</label>
                    <input type="number" class="form-control" name="medium_${recruiterCount}"
                           min="0" value="0" placeholder="0">
                </div>
                <div class="col-md-2">
                    <label class="form-label fw-semibold">Hard</label>
                    <input type="number" class="form-control" name="hard_${recruiterCount}"
                           min="0" value="0" placeholder="0">
                </div>
            </div>
            <div class="mt-2">
                <button type="button" class="btn btn-sm btn-outline-danger remove-recruiter-btn">
                    Remove
                </button>
            </div>
        `;

        container.appendChild(newRow);
        recruiterCount++;

        // Add event listener to remove button
        newRow.querySelector('.remove-recruiter-btn').addEventListener('click', function() {
            newRow.remove();
        });
    });

    // Reset form
    document.getElementById('resetBtn').addEventListener('click', function() {
        if (confirm('Are you sure you want to reset the form? All entered data will be lost.')) {
            location.reload();
        }
    });

    // Form validation
    document.getElementById('capacityForm').addEventListener('submit', function(e) {
        const inputs = document.querySelectorAll('input[type="text"][name^="name_"]');
        let hasValidInput = false;

        inputs.forEach(function(input) {
            if (input.value.trim() !== '') {
                hasValidInput = true;
            }
        });

        if (!hasValidInput) {
            e.preventDefault();
            alert('Please add at least one recruiter with a name.');
        }
    });
</script>
{% endblock %}
